version: '3'

services:
  web:
    image: techsuivi/web:latest
    container_name: ts_web
    ports:
      - "80:80"
    depends_on:
      - db
    environment:
      - DB_HOST=db
      - DB_NAME=techsuivi_db
      - DB_USER=techsuivi_user
      - DB_PASS=votre_password_ici # âš ï¸ Ã€ modifier
      - APP_URL=http://192.168.10.100 # âš ï¸ VÃ©rifiez votre IP
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      # ğŸ‘‡ Dossiers PERSISTANTS (Visibles dans File Station)
      - /share/Container/TechSuivi/uploads:/var/www/html/uploads
      # ğŸ‘‡ Volume DOCKER pour les tokens (Interne)
      - ts_vnc_tokens:/var/www/html/vnc_tokens
      # ğŸ‘‡ Volume DOCKER pour les clÃ©s Rustdesk (Pour le Backup/Restore)
      - ts_rustdesk_data:/var/www/rustdesk_data
    restart: always

  db:
    image: techsuivi/db:latest
    container_name: ts_db
    restart: always
    environment:
      - MARIADB_ROOT_PASSWORD=votre_root_password_ici # âš ï¸ Ã€ modifier
      - MARIADB_DATABASE=techsuivi_db
      - MARIADB_USER=techsuivi_user
      - MARIADB_PASSWORD=votre_password_ici # âš ï¸ Ã€ modifier
    volumes:
      - ts_db_data:/var/lib/mysql

  novnc:
    image: techsuivi/novnc:latest
    container_name: ts_novnc
    restart: unless-stopped
    network_mode: host
    volumes:
      # ğŸ‘‡ Le mÃªme volume DOCKER, en lecture seule pour NoVNC
      - ts_vnc_tokens:/tokens:ro

  # ğŸ‘‡ Service Rustdesk ID (HBBS) - AdaptÃ© de votre config
  hbbs:
    image: rustdesk/rustdesk-server:latest
    container_name: ts_hbbs
    command: hbbs
    environment:
      - ALWAYS_USE_RELAY=Y
    volumes:
      - ts_rustdesk_data:/root # ğŸ‘ˆ Volume gÃ©rÃ© par TechSuivi (Backup/Restore)
    network_mode: "host" # âš ï¸ Mode Host demandÃ©
    depends_on:
      - hbbr
    restart: unless-stopped

  # ğŸ‘‡ Service Rustdesk Relay (HBBR) - AdaptÃ© de votre config
  hbbr:
    image: rustdesk/rustdesk-server:latest
    container_name: ts_hbbr
    command: hbbr
    volumes:
      - ts_rustdesk_relay:/root # ğŸ‘ˆ Volume dÃ©diÃ© au Relay
    network_mode: "host" # âš ï¸ Mode Host demandÃ©
    restart: unless-stopped

volumes:
  ts_db_data:
  ts_vnc_tokens:
  ts_rustdesk_data: # ClÃ©s HBBS (SauvegardÃ©es via Web UI)
  ts_rustdesk_relay: # DonnÃ©es HBBR
